<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Hello friend" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Hello friend" /> <title> Example - Hello friend </title> <link rel="alternate" href="http://localhost:4000/example/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/example/" /> <meta name="description" content="Gui Pires&#39; personal website." /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="stylesheet" href="/assets/css/style.css" /> </head> <meta charset="utf-8"> <meta name="generator" content="pandoc"> <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"> <meta name="author" content="Gui Pires"> <meta name="dcterms.date" content="2023-05-25 00:00:00 -0700"> <title>Example – Hello friend</title> <!-- TODO(jez): canonical URL --> <!-- TODO(jez): OpenGraph tags --> <link rel="stylesheet" href="https://cdn.jsdelivr.net/font-et-book/0.1/et-book.min.css"> <link rel="stylesheet" href="/assets/css/main.css"> <!-- --> <!--[if lt IE 9]> <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script> <![endif]--> <body data-theme="light" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link" href="https://github.com/colobas" target="_blank" rel="noopener" >github</a ><a class="menu-link" href="/cv.pdf">cv</a></a> </div> </div> </nav> </div> <article> <h1 class="title">Example</h1> <p class="byline">Gui Pires &ndash; May 25, 2023 </p> <section id="sec:org079ea13" class="level1 unnumbered"> <h1 class="unnumbered"> 48 - Robot vacuum </h1> <p>An ellipsoid can alternatively be parameterized by <span class="math inline"><em>E</em> = {<em>c</em> + <em>Σ</em><sup>1/2</sup><em>u</em> : ∥<em>u</em>∥<sub>2</sub> ≤ 1}</span>. We can intersect it with the polyhedron constraints:</p> <p><span class="math display">$$\begin{aligned} \sup_{ {\lVert u \rVert}_2 \leq 1} {a_i}^T (c + \Sigma^{1/2} u) &amp;\leq b_i \\ {a_i}^T c + \sup_{ {\lVert u \rVert}_2 \leq 1} {a_i}^T \Sigma^{1/2} u &amp;\leq b_i \\ {a_i}^T c + \sup_{ {\lVert u \rVert}_2 \leq 1} \big((\Sigma^{1/2})^T a_i^T\big)^T u &amp;\leq b_i \\ {a_i}^T c + \sup_{ {\lVert u \rVert}_2 \leq 1} \big(\Sigma^{1/2} a_i^T\big)^T u &amp;\leq b_i \label{step4} &amp;&amp; \text{Because $\Sigma^{1/2}$ is symmetric}\\ {a_i}^T c + \left\lVert\Sigma^{1/2} a_i \right\rVert_{2} &amp;\leq b_i \label{step5} \\ {a_i}^T c + \left\lVert\Sigma^{1/2} a_i \right\rVert_{2} - b_i &amp;\leq 0 \end{aligned}$$</span></p> <p>The step from (<a href="#step4" data-reference-type="ref" data-reference="step4">[step4]</a>) to (<a href="#step5" data-reference-type="ref" data-reference="step5">[step5]</a>) can be understood by observing that the supremum of <span class="math inline">(<em>Σ</em><sup>1/2</sup><em>a</em><sub><em>i</em></sub><sup><em>T</em></sup>)<sup><em>T</em></sup><em>u</em></span> w.r.t <span class="math inline"><em>u</em></span> is reached when <span class="math inline"><em>u</em></span> is parallel to <span class="math inline">(<em>Σ</em><sup>1/2</sup><em>a</em><sub><em>i</em></sub>)<sup><em>T</em></sup></span>. Since <span class="math inline"><em>u</em></span> is a unit vector, we can rewrite it as <span class="math inline">$\frac{\Sigma^{1/2} a_i}{\left\lVert\Sigma^{1/2} a_i \right\rVert_{2} }$</span> and do</p> <p><span class="math display">$$\begin{aligned} (\Sigma^{1/2} a_i)^T \frac{\Sigma^{1/2} a_i}{\left\lVert\Sigma^{1/2} a_i \right\rVert_{2} } \ &amp;= \frac{ {\left\lVert\Sigma^{1/2} a_i \right\rVert_{2} }^2}{\left\lVert\Sigma^{1/2} a_i \right\rVert_{2} } \\ &amp;= \left\lVert\Sigma^{1/2} a_i \right\rVert_{2} \end{aligned}$$</span></p> <p>So we obtain a linear constraint for each column of <span class="math inline"><em>A</em></span>, and can thus write the LP:</p> <p><span class="math display">$$\begin{aligned} &amp; \min_{c} &amp; &amp; - e^T c \\ &amp; \textrm{s.t.} &amp; &amp; {a_i}^T c + \left\lVert\Sigma^{1/2} a_i \right\rVert_{2} - b_i \leq 0, i \in \{1,\ldots,m\} \end{aligned}$$</span></p> <p>To use my solution, we need to compute <span class="math inline"><em>Σ</em><sup>1/2</sup></span>. Luckily it is 2x2, so there is a straightforward formula (<a href="https://en.wikipedia.org/wiki/Square_root_of_a_2_by_2_matrix" class="uri">https://en.wikipedia.org/wiki/Square_root_of_a_2_by_2_matrix</a>).</p> <p>For the given matrix <span class="math inline"><em>Σ</em></span>, its square-root (computed by the linked method) is <span class="math display">$$\begin{aligned} \begin{bmatrix} 1.0603 &amp; -0.342025 \\ -0.342025 &amp; 2.9397 \end{bmatrix} \end{aligned}$$</span></p> <p>See below the implementation, using CVXPY:</p><pre><code>import cvxpy as cp
import numpy as np

c = cp.Variable(2)
A = np.array([
    [1, 1],
    [1, -1]
])
b = np.array([10, 10])
e = np.array([1, 0])

sigma_sqrt = np.array([
    [1.0603, -0.342025],
    [-0.342025,  2.9397],
])

# sqrt of validation sigma
#sigma_sqrt = np.array([
#    [1.3572 , 0.76605],
#    [0.76605, 2.6428 ]
#])

constraints = [
    A[i].T @ c + np.linalg.norm(sigma_sqrt @ A[i], ord=2) - b[i] &lt;= 0
    for i in range(2)
]

prob = cp.Problem(cp.Minimize(-e.T @ c), constraints)
prob.solve()

# Print result.
print(&quot;The optimal value is&quot;, prob.value)
print(&quot;A solution c is&quot;, c.value)

The optimal value is -6.8680318592201335
A solution c is [6.86803186 0.43681798]</code></pre></section> <section id="sec:org7e5391f" class="level1 unnumbered"> <h1 class="unnumbered"> 54 - Data rates </h1> <p>The objective function is linear, and most of the constraints are affine. The only problematic constraint is the budget constraint. I want to decouple the cost constraints from one another, because they have a tricky non-linearity. So introducing auxiliary variables <span class="math inline"><em>z</em><sub><em>i</em></sub></span>, we can rewrite the budget constraint as</p> <p><span class="math display">$$\begin{aligned} \begin{cases} \alpha_i x_i + \frac{\beta_i}{2}\max\{0, x_i - \frac{C_i}{2}\}^2 \leq z_i, i=1,...,5 \\ \sum_{i=1}^5 z_i \leq B \end{cases} \end{aligned}$$</span></p> <p>Rearranging the first inequality:</p> <div class="empheq"> <p>align _i x_i + {0, x_i - }^2 &amp;z_i<br /> {0, x_i - }^2 &amp;(z_i - _i x_i)</p> </div> <p>We can now use the equivalence shown in the lectures and write, with new auxiliary variables <span class="math inline"><em>y</em><sub><em>i</em></sub></span>:</p> <div class="empheq"> <p>align {0, x_i - } y_i <span id="ineq1" label="ineq1"></span><br /> y_i^2 (z_i - _i x_i) <span id="ineq2" label="ineq2"></span></p> </div> <p>Let us focus on inequality (<a href="#ineq2" data-reference-type="ref" data-reference="ineq2">[ineq2]</a>)</p> <p><span class="math display">$$\begin{aligned} y_i^2 &amp;\leq \underbrace{(z_i - \alpha_i x_i)\frac{2}{\beta_i} }_{\geq 0\text{, since~$\alpha_i x_i \geq 0$ and $\alpha_i x_i \leq z_i$} } \end{aligned}$$</span></p> <p>So we can use the “key fact” from the lectures and write:</p> <p><span class="math display">$$\begin{aligned} \left\lVert\begin{bmatrix} 2y_i \\ (z_i - \alpha_i x_i)\frac{2}{\beta_i} - 1\end{bmatrix}\right\rVert_2 &amp;\leq (z_i - \alpha_i x_i)\frac{2}{\beta_i} + 1 \end{aligned}$$</span></p> <p>Which is a valid constraint for a SOCP. Now, addressing (<a href="#ineq1" data-reference-type="ref" data-reference="ineq1">[ineq1]</a>), we can simply rewrite it as:</p> <p><span class="math display">$$\begin{aligned} 0 \leq y_i \\ x_i - \frac{C_i}{2} \leq y_i \end{aligned}$$</span></p> <p>So we arrive at the final form for our optimization problem, which we have shown can be cast as a SOCP:</p> <p><span class="math display">$$\begin{aligned} &amp; \max_{r, x_1, ..., x_5, z_1, ..., z_5, y_1, ..., y_5} &amp; &amp; r \\ &amp; \text{subject to} &amp; &amp; \\ &amp; &amp; &amp; r = x_1 + x_2 \\ &amp; &amp; &amp; x_1 + x_3 = x_4 \\ &amp; &amp; &amp; x_2 = x_3 + x_5 \\ &amp; &amp; &amp; x_4 + x_5 = r \\ &amp; &amp; &amp; x_i \geq 0 \\ &amp; &amp; &amp; x_i \leq C_i \\ &amp; &amp; &amp; \sum_{i=1}^5 z_i \leq B \\ &amp; &amp; &amp; \left\lVert\begin{bmatrix} 2y_i \\ (z_i - \alpha_i x_i)\frac{2}{\beta_i} - 1\end{bmatrix}\right\rVert_2 &amp;\leq (z_i - \alpha_i x_i)\frac{2}{\beta_i} + 1, i = 1, ..., 5 \\ &amp; &amp; &amp; 0 \leq y_i \\ &amp; &amp; &amp; x_i - \frac{C_i}{2} \leq y_i, i = 1, ..., 5 \\ \end{aligned}$$</span></p> <p>Rewritten in the canonical form:</p> <p><span class="math display">$$\begin{aligned} &amp; \min_{r, x_1, ..., x_5, z_1, ..., z_5, y_1, ..., y_5} &amp; &amp; -r \\ &amp; \text{subject to} &amp; &amp; \\ &amp; &amp; &amp; r - x_1 - x_2 = 0 \\ &amp; &amp; &amp; x_1 + x_3 - x_4 = 0 \\ &amp; &amp; &amp; x_2 - x_3 - x_5 = 0 \\ &amp; &amp; &amp; x_4 + x_5 - r = 0 \\ &amp; &amp; &amp; -x_i \leq 0 \\ &amp; &amp; &amp; x_i - C_i \leq 0 \\ &amp; &amp; &amp; \sum_{i=1}^5 z_i - B \leq 0 \\ &amp; &amp; &amp; \left\lVert\begin{bmatrix} 2y_i \\ (z_i - \alpha_i x_i)\frac{2}{\beta_i} - 1\end{bmatrix}\right\rVert_2 &amp;\leq (z_i - \alpha_i x_i)\frac{2}{\beta_i} + 1, i = 1, ..., 5 \\ &amp; &amp; &amp; -y_i \leq 0 \\ &amp; &amp; &amp; x_i - \frac{C_i}{2} - y_i \leq 0, i = 1, ..., 5 \\ \end{aligned}$$</span></p> <p>See below the implementation and solution in CVXPY</p><pre><code>import cvxpy as cp
import numpy as np

r = cp.Variable(1)
x = cp.Variable(5)

# to give the flow constraints in vector form
vec_r = cp.reshape(r, (1, 1))
vec_x = cp.reshape(x, (5, 1))
flow_vars = cp.reshape(cp.vstack((vec_r, vec_x)), 6)

# auxiliary vars
y = cp.Variable(5)
z = cp.Variable(5)

B = 15.
alpha = np.array([2., 1., 5., 3., 1.])
beta = np.array([2., 2., 0.5, 2., 1.])
C = np.array([10., 6., 8., 10., 8.])

F = np.array([
    # r  x1  x2  x3  x4  x5
    [ 1, -1, -1,  0,  0,  0],
    [ 0,  1,  0,  1, -1,  0],
    [ 0,  0,  1, -1,  0, -1],
    [-1,  0,  0,  0,  1,  1],
])

ones = np.ones(5)

constraints = [
    F @ flow_vars &lt;= 0,
    ones @ z &lt;= B,
    y &gt;= 0,
    x - C/2 - y &lt;= 0,
    x &gt;= 0,
    x &lt;= C
]

constraints += [
    cp.pnorm(
        cp.vstack((2*y[i],
                  (z[i] - alpha[i]*x[i])*2/beta[i] - 1)),
        p=2
    ) &lt;= (z[i] - alpha[i]*x[i])*2/beta[i] + 1
    for i in range(5)
]

prob = cp.Problem(cp.Minimize(-r), constraints)
prob.solve()

# Print result.
print(&quot;The optimal value r is&quot;, r.value)
print(&quot;The optimal link x is&quot;, x.value)

The optimal value r is [5.23333333]
The optimal link x is [8.99999988e-01 4.33333334e+00 5.11970231e-11 8.99999988e-01
 4.33333334e+00]</code></pre></section> <section id="sec:org737d322" class="level1 unnumbered"> <h1 class="unnumbered"> 61 - Optimal linear estimators for uncertain covariance </h1> <p>We can rewrite the cost function (omitting the supremum specification for brevity) as:</p> <p><span class="math display">$$\begin{aligned} \sup\Big\{ \begin{bmatrix} s^T &amp; -1 &amp; r \end{bmatrix} \begin{bmatrix} \Sigma + \mu \mu^T &amp; \mu \\ \mu &amp; 1 \\ \end{bmatrix} \begin{bmatrix} s \\ -1 \\ r \end{bmatrix} \Big\} &amp;= \sup\Big\{ \begin{bmatrix} s^T &amp; -1 &amp; r \end{bmatrix} \begin{bmatrix} \sum_{k=1}^K \pi_k \Sigma_k + \mu \mu^T &amp; \mu \\ \mu &amp; 1 \\ \end{bmatrix} \begin{bmatrix} s \\ -1 \\ r \end{bmatrix} \Big\} \\ &amp;= \sup\Big\{ \begin{bmatrix} s^T &amp; -1 &amp; r \end{bmatrix} \begin{bmatrix} \mu \mu^T &amp; \mu \\ \mu &amp; 1 \\ \end{bmatrix} \begin{bmatrix} s \\ -1 \\ r \end{bmatrix} + s^T \big( \sum_{k=1}^K \pi_k \Sigma_k\big) s \Big\} \\ &amp;= \begin{bmatrix} s^T &amp; -1 &amp; r \end{bmatrix} \begin{bmatrix} \mu \mu^T &amp; \mu \\ \mu &amp; 1 \\ \end{bmatrix} \begin{bmatrix} s \\ -1 \\ r \end{bmatrix} + \sup\Big\{ s^T \big( \sum_{k=1}^K \pi_k \Sigma_k\big) s \Big\} \label{supr1} \\ &amp;= \begin{bmatrix} s^T &amp; -1 &amp; r \end{bmatrix} \begin{bmatrix} \mu \mu^T &amp; \mu \\ \mu &amp; 1 \\ \end{bmatrix} \begin{bmatrix} s \\ -1 \\ r \end{bmatrix} + \sup\Big\{ \sum_{k=1}^K \pi_k s^T \Sigma_k s \Big\} \\ &amp;= \begin{bmatrix} s^T &amp; -1 &amp; r \end{bmatrix} \begin{bmatrix} \mu \mu^T &amp; \mu \\ \mu &amp; 1 \\ \end{bmatrix} \begin{bmatrix} s \\ -1 \\ r \end{bmatrix} + \max\Big\{s^T \Sigma_k s \Big\} \end{aligned}$$</span></p> <p>In (<a href="#supr1" data-reference-type="ref" data-reference="supr1">[supr1]</a>) I move the supremum in, because <span class="math inline">$\begin{bmatrix} \mu \mu^T &amp; \mu \\ \mu &amp; 1 \\ \end{bmatrix}$</span> is positive semi-definite and so the first term is <span class="math inline"> ≥ 0</span>, and independent from the <span class="math inline"><em>Σ</em><sub><em>k</em></sub></span>. To take the final step, we use the fact that all of the <span class="math inline"><em>Σ</em><sub><em>k</em></sub></span> are p.s.d. (since they are covariance matrices), and so all of the summands are <span class="math inline">≥</span> 0, and since <span class="math inline">∑<em>π</em><sub><em>k</em></sub> = 1</span> and <span class="math inline"><em>π</em><sub><em>k</em></sub> ≥ 0</span>, the supremum is reached when we put all of the “mass” of <span class="math inline"><em>π</em></span> in the term with the largest value.</p> <p>Now, introducing two epigraph variables, we can rewrite the problem:</p> <p><span class="math display">$$\begin{aligned} &amp; \min_{s, r, t_1, t_2} &amp; &amp; t_1 + t_2 \\ &amp; \text{subject to} &amp; &amp; \\ &amp; &amp; &amp; \begin{bmatrix} s^T &amp; -1 &amp; r \end{bmatrix} \begin{bmatrix} \mu \mu^T &amp; \mu \\ \mu &amp; 1 \\ \end{bmatrix} \begin{bmatrix} s \\ -1 \\ r \end{bmatrix} \leq t_1 \\ &amp; &amp; &amp; \max\Big\{s^T \Sigma_k s \Big\} \leq t_2 \end{aligned}$$</span></p> <p>Using the fact that <span class="math inline">max {<em>a</em><sub>1</sub>, ..., <em>a</em><sub><em>K</em></sub>} ≤ <em>ϵ</em> ↔︎ <em>a</em><sub><em>i</em></sub> ≤ <em>ϵ</em>, <em>i</em> = 1, ..., <em>K</em></span>, we can substitute the second inequality by <span class="math inline"><em>K</em></span> inequalities:</p> <p><span class="math display">$$\begin{aligned} &amp; \min_{s, r, t_1, t_2} &amp; &amp; t_1 + t_2 \\ &amp; \text{subject to} &amp; &amp; \\ &amp; &amp; &amp; \begin{bmatrix} s^T &amp; -1 &amp; r \end{bmatrix} \begin{bmatrix} \mu \mu^T &amp; \mu \\ \mu &amp; 1 \\ \end{bmatrix} \begin{bmatrix} s \\ -1 \\ r \end{bmatrix} \leq t_1 \\ &amp; &amp; &amp; s^T \Sigma_k s \leq t_2,\ k = 1,..,K \end{aligned}$$</span></p> <p>which is a QCQP.</p> </section> </article> <footer class="footer"> <!--<a class="footer_item" href="javascript::void(0)">resume</a>--> <span class="footer_item">&copy; 2023</span> <small class="footer_copyright"> <!-- Klisé Theme: https://github.com/piharpi/jekyll-klise --> Based on <a href="https://github.com/piharpi/jekyll-klise" target="_blank" rel="noreferrer noopener" >klisé</a> and <a href="https://github.com/jez/tufte-pandoc-jekyll" target="_blank" rel="noreferrer noopener">tufte-pandoc-jekyll</a> </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </body> </html>
